!function(t,e,o){"use strict";function a(){this.checkTime=5e3,this.processLocalXHR()}a.prototype.cacheList=JSON.parse(o.jqOffline||"[]"),a.prototype.timeoutId=null,a.prototype.networkIsConnect=!0,a.prototype.offConfig=function(){return{accessStatus:[500,404],message:"Network not connect, data has saved in localStorage.",key:"",checkTime:this.checkTime}},a.prototype.startCheck=function(t){var e=this;e.timeoutId=setTimeout(function(){e.processLocalXHR(),e.startCheck(t)},t.offConfig.checkTime)},a.prototype.stopCheck=function(){e.clearTimeout(this.timeoutId)},a.prototype.processLocalXHR=function(){var e=this;e.cacheList.length&&t.each(e.cacheList,function(t,a){var n=JSON.parse(o[a]);e.main("ajax",n).done(function(t,o){e.checkIsAccessStatus(o,n)||(e.removeKeyFromList(n.offConfig.key),e.networkIsConnect=!0)})})},a.prototype.checkIsAccessStatus=function(e,o){return-1!==t.inArray(e,o.offConfig.accessStatus)},a.prototype.removeKeyFromList=function(e){var a=this,n=t.inArray(e,a.cacheList);return n>=0?(o.removeItem(e),a.splice(n,1),!0):!1},a.prototype.saveDataInLocal=function(e){var a=this;e.offConfig.key=e.offConfig.key?e.offConfig.key:"offline_"+(new Date).getTime()+Math.floor(1e4*Math.random()),o[e.offConfig.key]=JSON.stringify(e),-1===t.inArray(e.offConfig.key,a.cacheList)&&a.cacheList.push(e.offConfig.key),o.jqOffline=JSON.stringify(this.cacheList),a.timeoutId||a.startCheck(e)},a.prototype.post=function(t,e,o,a){return this.ajaxXHRGateway.call(this,e,o,a,"post")},a.prototype.get=function(t,e,o,a){return this.ajaxXHRGateway.call(this,e,o,a,"get")},a.prototype.put=function(t,e,o,a){return this.ajaxXHRGateway.call(this,e,o,a,"put")},a.prototype.delete=function(t,e,o,a){return this.ajaxXHRGateway.call(this,e,o,a,"delete")},a.prototype.ajaxXHRGateway=function(e,o,a,n){return t.isFunction(o)&&(n=n||a,a=o,o=void 0),this.ajax({url:e,type:n,data:o,success:a})},a.prototype.ajax=function(e,o){var a=this,n=t.Deferred();return"object"==typeof e&&(o=e,e=void 0),o=t.extend({offConfig:a.offConfig()},o),t.ajax(o).done(function(t,e){a.checkIsAccessStatus(e,o)?(a.saveDataInLocal(o),n.resolve(o.offConfig,e)):n.resolve.apply(a,arguments)}).fail(function(t){a.checkIsAccessStatus(t.status,o)?(a.saveDataInLocal(o),n.resolve(o.offConfig,t.status)):n.reject.apply(a,arguments)}),n.promise()},a.prototype.main=function(t){var e=this;switch(t){case"isConnect":return e.networkIsConnect;case"start":e.startCheck();break;case"stop":e.stopCheck();break;case"setCheckTime":var o=parseInt(arguments[1]);return o&&o>0&&(e.checkTime=o),e;case"get":return e.get.apply(e,arguments);case"post":return e.post.apply(e,arguments);case"put":return e.put.apply(e,arguments);case"delete":return e.delete.apply(e,arguments);case"ajax":return e.ajax.apply(e,arguments);default:return e}};var n=new a;t.offline=function(){return n.main.apply(n,arguments)}}(jQuery,window,window.localStorage);